{% extends "govuk/template.njk" %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}

{% set bodyClasses = ("env--" + environmentName) if environmentName %}

{% block head %}
  <link href="/assets/stylesheets/application.css?{{ version }}" rel="stylesheet"/>

  {% if matomoEnabled %}

  {% if matomoSiteId %}
    <!-- Matomo -->
    <script nonce="{{ cspNonce }}">
      var _paq = window._paq = window._paq || [];
      /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//matomo-dev.hmpps.service.justice.gov.uk/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '{{ matomoSiteId }}']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Matomo Code -->
  {% endif %}

  {% if matomoContainerId %}
    <!-- Matomo Tag Manager -->
    <script nonce="{{ cspNonce }}">
      var _mtm = window._mtm = window._mtm || [];
      _mtm.push({'mtm.startTime': (new Date().getTime()), 'event': 'mtm.Start'});
      (function() {
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src='https://matomo-dev.hmpps.service.justice.gov.uk/js/container_{{ matomoContainerId }}.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Matomo Tag Manager -->
  {% endif %}

  {% endif %}

  {% for js in feComponents.jsIncludes %}
    <script src="{{ js }}" nonce="{{ cspNonce }}"></script>
  {% endfor %}

  {% for css in feComponents.cssIncludes %}
    <link href="{{ css }}" nonce="{{ cspNonce }}" rel="stylesheet" />
  {% endfor %}
{% endblock %}

{% block pageTitle -%}
  {%- if errors | length %}Error: {% endif %}
  {%- if pageHeaderTitle %}{{ pageHeaderTitle }} - {% endif %}
  {{- applicationName }} - DPS
{%- endblock %}

{% block header %}
  {{ feComponents.header | safe }}
{% endblock %}

{% block bodyStart %}
{% endblock %}

{% block beforeContent %}
  {% if backLinkHref %}
    <div role="navigation">
      {{ govukBackLink({
        text: "Back",
        href: backLinkHref
      }) }}
    </div>
  {% endif %}
{% endblock %}

{% block footer %}
  {{ feComponents.footer | safe }}
{% endblock %}

{% block bodyEnd %}
  {# Run JavaScript at end of the
  <body>, to avoid blocking the initial render. #}
  <script type="module" src="/assets/index.js"></script>
  {# Javascript block for individual pages #}
  {% block pageScripts %}
  {% endblock %}
{% endblock %}
