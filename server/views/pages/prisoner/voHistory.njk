{% extends "layout.njk" %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{%- from "govuk/components/tag/macro.njk" import govukTag -%}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/tabs/macro.njk" import govukTabs %}
{% from "govuk/components/checkboxes/macro.njk" import govukCheckboxes %}
{%- from "moj/components/banner/macro.njk" import mojBanner -%}
{%- from "moj/components/alert/macro.njk" import mojAlert -%}
{% from "components/combinedVisitStatus.njk" import combinedVisitStatus %}


{% set pageHeaderTitle = "Visiting orders history" %}

{% set backLinkHref = "/prisoner/" + prisonerId %}

{% set displayRows = [] %}

{% for history in historyItems %}

  {% set displayRows = (displayRows.push([
    {
      text: history.date | formatDate('dd/MM/yyyy'),
      attributes: { "data-test": "history-date-" + loop.index }
    },
    {
      html: history.reason,
      attributes: { "data-test": "history-reason-" + loop.index }
    },
    {
      text: history.voBalanceChange if history.voBalanceChange else '0',
      attributes: { "data-test": "history-voBalanceChange-" + loop.index }
    },
    {
      text: history.voBalance,
      attributes: { "data-test": "history-voChange-" + loop.index },
      classes: "govuk-!-font-weight-bold"
    },
    {
      text: history.pvoBalanceChange if history.pvoBalanceChange else '0',
      attributes: { "data-test": "history-pvoBalanceChange-" + loop.index }
    },
    {
      text: history.pvoBalance,
      attributes: { "data-test": "history-pvoChange-" + loop.index },
      classes: "govuk-!-font-weight-bold"
    }
  ]), displayRows) %}
{% endfor %}


{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">

      <h1 class="govuk-heading-l">{{ pageHeaderTitle }}</h1>

      <ul class="vo-history-summary">
        <li>
          <strong>Prisoner name</strong>
          <span data-test="prison-number">{{ prisonerDetails.prisonerName }}</span>
        </li>
          <strong>Category</strong>
          <span data-test="category">{{ prisonerDetails.category }}</span>
        </li>
        <li>
          <strong>Conviction status</strong>
          <span data-test="convicted-status">{{ prisonerDetails.convictedStatus }}</span>
        </li>
        <li>
          <strong>Incentive level</strong>
          <span data-test="iep-level">{{ prisonerDetails.incentiveLevel }}</span>
        </li>
      </ul>

      {{ govukTable({
          head: [
            {
              text: "Date"
            },
            {
              text: "Reason"
            },
            {
              text: "VO change"
            },
            {
              text: "VO balance"
            },
            {
              text: "PVO change"
            },
            {
              text: "PVO balance"
            }
          ],
          rows: displayRows,
          attributes: { "data-test": "abcd" }
        }) }}
    </div>
  </div>

{% endblock %}
