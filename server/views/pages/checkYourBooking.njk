{% extends "layout.njk" %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{% set pageHeaderTitle = "Check the visit details before booking" %}
{% set pageTitle %}
{% if errors | length %}Error: {% endif %}{{ applicationName }} - {{ pageHeaderTitle }}
{% endset %}

{% block content %}
<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        {% include "partials/errorSummary.njk" %}
        <h1 class="govuk-heading-l">{{ pageHeaderTitle }}</h1>
        <p>A reference number will be provided once the booking is confirmed.</p>
    </div>
</div>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        <h2 class="govuk-heading-m">Prisoner details</h2>
        {{ govukSummaryList({
            rows: [
                {
                    key: {
                        text: "Name"
                    },
                    value: {
                        text: prisoner.name
                    }
                },
                {
                    key: {
                        text: "Prison number"
                    },
                    value: {
                        text: prisoner.offenderNo
                    }
                },
                {
                    key: {
                        text: "Date of birth"
                    },
                    value: {
                        text: prisoner.dateOfBirth
                    }
                },
                {
                    key: {
                        text: "Location"
                    },
                    value: {
                        text: prisoner.location
                    }
                }
            ]
        }) }}
    </div>
</div>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-one-half">
        <h2 class="govuk-heading-m">Visit details</h2>
    </div>
    <div class="govuk-grid-column-one-half bapv-change-details-link">
        <a href="#" class="govuk-link">Change</a>
    </div>
</div>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        {{ govukSummaryList({
            rows: [
                {
                    key: {
                        text: "Date"
                    },
                    value: {
                        text: visit.startTimestamp | formatDate("EEEE d MMMM yyyy")
                    }
                },
                {
                    key: {
                        text: "Time"
                    },
                    value: {
                        text: visit.startTimestamp | formatTime + " to " + visit.endTimestamp | formatTime
                    }
                },
                {
                    key: {
                        text: "Visit type"
                    },
                    value: {
                        text: "Open"
                    }
                }
            ]
        }) }}
    </div>
</div>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-one-half">
        <h2 class="govuk-heading-m">Visitor details</h2>
    </div>
    <div class="govuk-grid-column-one-half bapv-change-details-link">
        <a href="#" class="govuk-link">Change</a>
    </div>
</div>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        {%- for visitor in visitors %}
            <h3 class="govuk-heading-m">Visitor {{ loop.index }}</h3>
            {{ govukSummaryList({
                rows: [
                    {
                        key: {
                            text: "Name"
                        },
                        value: {
                            text: visitor.name + " (" + (visitor.relationshipDescription | lower) + " of the prisoner)"
                        }
                    },
                    {
                        key: {
                            text: "Address"
                        },
                        value: {
                            text: visitor.address | replace("<br>", " ")
                        }
                    }
                ]
            }) }}
        {% endfor %}
    </div>
</div>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-one-half">
        <h2 class="govuk-heading-m">Additional support</h2>
    </div>
    <div class="govuk-grid-column-one-half bapv-change-details-link">
        <a href="#" class="govuk-link">Change</a>
    </div>
</div>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        {% set additionalSupportRows = [] %}
        {% for item in additionalSupport %}
          {% set additionalSupportRows = (additionalSupportRows.push(
            {
              key: {
                text: "Request " + loop.index
              },
              value: {
                text: item
              }
            }
          ), additionalSupportRows) %}
        {% endfor %}
        {% if (additionalSupportRows | length) %}
            {{ govukSummaryList({
                rows: additionalSupportRows
            }) }}
        {% else %}
        <p>No additional support options were chosen.</p>
        {% endif %}
    </div>
</div>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-one-half">
        <h2 class="govuk-heading-m">Contact details</h2>
    </div>
    <div class="govuk-grid-column-one-half bapv-change-details-link">
        <a href="#" class="govuk-link">Change</a>
    </div>
</div>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        {% set contactName %}
        {% if mainContact.contactName %}
        {{ mainContact.contactName }}
        {% else %}
        {{ mainContact.contact.name + " (" + (mainContact.contact.relationshipDescription | lower) + " of the prisoner)" }}
        {% endif %}
        {% endset %}
        {{ govukSummaryList({
            rows: [
                {
                    key: {
                        text: "Main contact"
                    },
                    value: {
                        text: contactName
                    }
                },
                {
                    key: {
                        text: "Phone number"
                    },
                    value: {
                        text: mainContact.phoneNumber
                    }
                }
            ]
        }) }}
    </div>
</div>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        <form action="/visit/check-your-booking/{{ offenderNo }}" method="POST" novalidate>
            <input type="hidden" name="_csrf" value="{{ csrfToken }}">
            {{ govukButton({
                text: "Submit booking"
            }) }}
        </form>
    </div>
</div>
{% endblock %}
